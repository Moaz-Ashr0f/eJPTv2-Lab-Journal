# ๐งช Lab 02 โ Samba Recon: Basics


## ๐ฏ ุงููุฏู ูู ุงููุงุจ
ูุนุฑูุฉ ุจุฑูุชูููู SMB ูููููุฉ:
- ูุญุต ุงูุจูุฑุชุงุช
- ูุญุต ุฅุนุฏุงุฏุงุช ุงูุฃูุงู ุงูุฎุงุตุฉ ุจู SMB
- ูุนุฑูุฉ ุงูู Users ูุงููููุงุช ุงูููุฌูุฏุฉ ุนูู ุงูุณูุฑูุฑ
- ุงูุฏุฎูู ุจููุฒุฑ ุญูููู
- ูุนุฑูุฉ ุงูู Sessions ุงูุชู ุชุนูู ุญุงูููุง
- ูุนุฑูุฉ ุฅุญุตุงุฆูุงุช ุงูุณูุฑูุฑ (ุนุฏุฏ ุงููููุงุช ุงูููุชูุญุฉุ ูุญุงููุงุช ุงูุฏุฎูู ุงููุงุดูุฉ...ุฅูุฎ)

---

 ุฅูู ูู SMBุ

ุงูู **SMB** ูู ุจุฑูุชูููู ุจูุณุชุฎุฏู ุฏุงุฎู ุงูุดุจูุฉุ ุจูููู ุงูุฃุฌูุฒุฉ ุฅููุง ุชูุฏุฑ ุชุดุงุฑู ูููุงุช ุฃู ุทุงุจุนุงุช ุฃู ูููุฏุฑุงุช ุจูู ุงูุฃุฌูุฒุฉุ ูุชููู ุฅู ุงูุฃุฌูุฒุฉ ุงูุชุงููุฉ ุชูุฏุฑ ุชูุตู ููุญุงุฌุงุช ุฏู ุนูู ุฌูุงุฒ ูุนูู ูุดุบูู ุนูุฏู ุฎุฏูุฉ SMB.

 ูุซุงู ูุงูุนู:

ุชุฎูู ุฅู ูู ุดุฑูุฉุ ูุนูุฏูู ุณูุฑูุฑ ุนููู ูููุงุช HR ูุซููุง.  
ูู ูุณุคูู IT ูุนูู **Share Folder** ููู ุงููููุงุช ุฏูุ ููุฎูู ุงูููุธููู ููุฏุฑูุง ููุตููุง ููู ูู ุฃุฌูุฒุฉ ุชุงููุฉ ุนูู ุงูุดุจูุฉ.  
ุงููู ุจูุฎูู ุฏู ูุดุชุบู ูู ุจุฑูุชูููู SMB.


 ูู Pentester

ูู ุงูุฌูุงุฒ ุนููู ุฎุฏูุฉ SMB (ูุนูู ุงูุจูุฑุช 445 ููุชูุญ)ุ ุฏู ูุนูุงู ุงุญุชูุงู ูุจูุฑ ูููู ูู:

- ูููุฏุฑุงุช ูุชุดุงุฑูุฉ
- ูุณุชุฎุฏููู ูููุด ุนูููู ุตูุงุญูุงุช ูููุณุฉ
- ูููุงุช ูููู ุชูุตู ููุง ุจุฏูู Password
- ุฃู ุญุชู ุซุบุฑุงุช ูู ูุณุฎุฉ SMB ุงููู ุดุบุงูุฉ

---


 1๏ธโฃ ูุญุต ุงูุจูุฑุช 445 ููุนุฑูุฉ ุงูุจุฑูุชููููุงุช ุงููุฏุนููุฉ
 
ูู ุงูุจุฏุงูุฉ ุจุฏุฃุช ุฃุฌูุน ูุนูููุงุช ุนู ุงูุจูุฑุชุงุช ุงูููุชูุญุฉ ุจุงุณุชุฎุฏุงู Nmap.  
ูููุง ูููุช ุฅู ุจูุฑุช 445 ููุชูุญ (ูุฏู ุงูุจูุฑุช ุงูุฎุงุต ุจุจุฑูุชูููู SMB) ูุฑุฑุช ุฃุณุชุฎุฏู ุณูุฑูุจุช ูู ุงูู Nmap Scripting Engine ุนูุดุงู ุฃุนุฑู ุงูุจุฑูุชููููุงุช ูุงููุณุฎ ุงููู ุงูุฎุฏูุฉ ุจุชุฏุนููุง.

```
nmap -p 445 --script smb-protocols <target>
```

๐ ุงููุชูุฌุฉ:  
ุงูุฎุฏูุฉ ุจุชุฏุนู [SMBv1, SMBv2, SMBv3] โ ูุฏู ููู ุฌุฏูุง ูุฃู ุจุนุถ ุงูุฅุตุฏุงุฑุงุช ุงููุฏููุฉ (ุฒู SMBv1) ูููุง ุซุบุฑุงุช ุฎุทูุฑุฉ ุฒู **EternalBlue**

โ ูุนูู ุฅูู ุจูุฏุนู ุงูู 3 ุฅุตุฏุงุฑุงุชุ  
ุฏู ูุนูุงู ุงู ุงูุฌูุงุฒ ุงููู ุดุบุงู ุนููู ุงูุฎุฏูู ุจููููู ุงูุง ุจุฏุนู ุงู 3 ุงุตุฏุงุฑุงุช ุฏูู ูุงูุง ูุณุชุนุฏ ุงููู ุงู ุฌูุงุฒ ุนูุฏู ุงู ุงุตุฏุงุฑ ูู ุฏูู ูุนูู ูู ุฌูุงุฒู ุจูุทูุจ ุงุชุตุงู ุจ v1 ูููุงูู ูู ุจ v3 ูููุงูู


โ ุงููุดููุฉ:  
SMBv1 
ูุฏูู ุฌุฏูุง ูููู ุซุบุฑุงุช ุฎุทูุฑุฉ ุฒู **EternalBlue**ุ ูุงููู ุงุชุณุจุจุช ูู ุงุฎุชุฑุงูุงุช ุถุฎูุฉ ุฒู ููุฑูุณ **WannaCry** ุงููู ุดูุฑ ูููุงุช ุฃุฌูุฒุฉ ูุชูุฑ ูุทูุจ ูุฏูุฉ.

๐ ุงู ูู ุซุบุฑู ุงู EternalBlue ุ
ุงู v1 ูู smb ุนูุฏู ุซุบุฑู ุจุชุฎูู ุงูุงุชุงูุฑ ูุนูู remote code execution ุงููู ูุดุบููุง ููุฏ ุนู ุจุนุฏ ุนูู ุงููุงุดููู ุงููู ุงูุจุฑูุชูููู ุดุบุงู ุนูููุง ูุงูุงุชุงูุฑ ุงุณุชุบููุง ุฏู ูุงุฎุชุฑููุง ุงูุงุฌูุฒู ุงููู ูุด ุนุงููู patch ููุฒููุง ุนูููุง ููุฑูุณ ุงููุฏูู **WannaCry** ุงููู ูุดูุฑูุง ุงููููุงุช ููุทูุจูุง ูุฏูู ุนุดุงู ูุฑุฌุนูุง ุงููููุงุช ุงููุฌูู ุงูุชุดุฑ ุจุณุฑุนุฉ ุฑููุจุฉ ูู ุงูุดุจูุงุช ูุฃู ุงูู **SMB** ุจูููู ููุนูู ุงูุชุฑุงุถููุง ูู ูุณุฎ ุงููููุฏูุฒ ุงููุฏููุฉ.



---

 2๏ธโฃ ูุญุต ุฅุนุฏุงุฏุงุช ุงูุฃูุงู ูู SMB

ุนุงูุฒูู ูุนุฑู ุงู ุงุฎุจุงุฑ ุงูุงูุงู ุงูุฎุงุต ุจุงูุฎุฏูู ุจุชุงุน ุงู smb ุงููู ุดุบุงูู ุนูู ุงูุฌูุงุฒ ุฏู  ูุงุณุชุฎุฏููุง ุงูุงุณูุฑูุจุช ุงูุชุงูู ุฏู 

```
nmap -p445 --script smb-security-mode <target>
```

๐ ุงููุชุงุฆุฌ:

- ุจููุจู ุงุชุตุงู ุจุฏูู ููุฒุฑ ููู ูุจุงุณูุฑุฏ

- ุจูุณุชุฎุฏู **user-level authentication** (ูุด share-level) ูุฏู ูุนูุงู ุงูู ุนุดุงู ูุฎุด ุนูู ุงูุญุงุฌุงุช ุงููู ูุนููู ูููุง ุดูุฑ ุจูุฎุด ุจููุฒ ูุจุงุณูุฑุฏ ูุฏู ุนูุณ ุงู share level ุงููู ุจูุฎููู ุชุฎุด ุนูู ุงููููุงุช ุจุจุงุณูุฑุฏ ููุท ูููุด ููุฒุฑ

- ุจูุฏุนู challenge-response ููู ุงู ุงูุณูุฑูุฑ  ุชุญุฏู ุจูุชุญู ุจุงูุจุงุณูุฑุฏ ูุงูุช ุชุญู ูุชุจุนุช  ูุงูุณูุฑูุฑ ูุดูู ุงูุฑุฏ ุจุชุงุนู ูู ุตุญ ููุง ูุง ูุจูุงุก ุนูู ุฏู ูุฏุฎูู ุงู ูููุนู ูุฏู  ุจูุญูู ุงูุจุงุณูุฑุฏ ูู ุงูู ูุชุณุฑุจ ุจุณูููู

- โ ูุง ูุฏุนู message signing โ ูุนูู ุงูุงุชุตุงู ุบูุฑ ูุคูููู ุถุฏ ุงูุชูุงุนุจ ูุงูู MITM ูุชูููุน ุงูุฑุณุงุฆู ูุนูู ูู ุฑุณุงูู ูุนุฏูู ุจูู ุฌูุงุฒู ูุงูุณูุฑูุฑ ูููุนู ุนุดุงู ูู ุญุฏ ุญุงูู ูุบูุฑ ูููุง ุงููุณุชูู ููุชุดู ุฏู ูุฏูููุชู ุงูุช ูุด ุจุชุฏุนู ุฏู ูุฏู ุฎุทุฑ ุงู ุงู ุญุฏ ูููู ูุชุฏุฎู ูู ุงูุงุชุตุงู ููุนุฏู ูู ุงูุจูุงูุงุช ููููู ู man in the middle ูุฏู ุญุงุฌุฉ ุฎุทูุฑุฉ ูู ุจูุฆุฉ ูููุง ุฃูุซุฑ ูู ุฌูุงุฒ



---


3๏ธโฃ ููู ุงูููุฒุฑ ุงููู ุดุบุงู ุฏูููุชูุ (Enumerate Sessions)

ุงุณุชุฎุฏููุง ุงุณูุฑูุจุช ุจูุญุงูู ูุฌูุจูู **ููู ุดุบุงู ุฏูููุชู (logged in)** ุนูู ุงูุณูุฑูุฑ ุงููู ุจูุดุบู ุฎุฏูุฉ SMB 

```
nmap -p445 --script smb-enum-sessions demo.ine.local
```

๐ ุงููุชูุฌุฉ:  
ููู ููุฒุฑ ุงุณูู `bob` ุดุบุงู ุนูู ุงูุณูุฑูุฑ WIN-OMCNBKR66MN 
ูุงููุนูููุฉ ุฏู ุธูุฑุช ูุฃู ุงูุณูุฑูุฑ ููุนู ุฎุงุตูุฉ ุงูู **Guest** ููุฏุฑุช ุงุฎุด ุนูู ุงูุณูุฑูุฑ ุจุฏูู ููุฒููู ุงู ุจุงุณูุฑุฏ

ูููู ูููุงุฌู ุชุณุชุฎุฏู ุงุณู ุงูููุฒุฑ ูู Brute-force attack


---

 4๏ธโฃ ุงูุฏุฎูู ุจููุฒุฑ ุญูููู ููุนุฑูุฉ ุงูุฌูุณุงุช:
 ุงุณุชุฎุฏูุช ุจุงุณูุฑุฏ ูููุฒุฑ ุญููููู ุนุดุงู ุงูุฏุฑ ุงุนุฑู ุงููุนูููุงุช ุงููู ูุตุฑุญ ููุง ูู ุงูุณูุฑูุฑ ุงูู ุงุนุฑููุง ูููุฒุฑ ูุนูู 

```
nmap -p445 --script smb-enum-sessions --script-args smbusername=administrator,smbpassword=smbserver_771 demo.ine.local
```

๐ ุฏู ุจูุดุชุบู ุฒู ูุง ุชุฏุฎู ููุชุจุฉ:

- ูู ุบูุฑ ุจุทุงูุฉ (Guest): ุชุดูู ุงููุงุณ ูู ุจุนูุฏ
- ุจุจุทุงูุฉ (ููุฒุฑ ูุจุงุณูุฑุฏ): ุชุณุฃู ูุชุงุฎุฏ ุฃุณูุงุก ุงููุงุณ ุงููู ููุฌูุฏุฉ
    

---


 5๏ธโฃ ูุนุฑูุฉ ุงููููุงุช ุงููู ูุนูููุฉ ูููุง ุดูุฑ:
 
  ุงุณุชุฎุฏูุช ุงุณูุฑูุจุช ููุงู ุนุดุงู ุงูุฏุฑ ุงุทูุน ุงููููุงุช ุงููู ูุนููู ูููุง ุดูุฑ ุนูู ุงูุณูุฑูุฑ ูุนุฑูุช ุงุณู ูู share ูููุนู ูุฎูู ููุง ุธุงูุฑ ููู ููุฏุฑ ุงูุตูู ู guest ููุง ูุง ูุงู ููุน ุงูุตูุงุญูุงุช ุงููู ุนูุฏู ุนููู ุญุงููุง ูุถูู ูุงูุฏุฑ ุงุฎุด ูุซูุง ุงุฏูุฑ ูู ุงููููุงุช ุงููู ูุณููุญ ุงูุฑุงูุง ูููู ุงูุงูู ูุนูููุงุช ุญุณุงุณู ูุซูุง

```
nmap -p445 --script smb-enum-shares demo.ine.local
```

๐ ุงููุชูุฌุฉ:  
ููููุง ุงูููู `IPC$` โ ูุฏู ุงูููุงุฉ ุงููู ุงูุจุฑุงูุฌ ุจุชุนุฏู ูููุง ุนูุดุงู ุชุชููู ูุน ุงูุณูุฑูุฑ.  
**ูุด ุนูุดุงู ุชุฏุฎู ูููุฏุฑุงุชุ ููู ุนูุดุงู ุชุจุนุช ูุชุณุชูุจู ุฃูุงูุฑ ููุนูููุงุช.**
ุฒู  ุงูุงุณูุฑูุจุช `smb-enum-shares` ุฃู `smb-enum-sessions` ุฃู ุฃู ุฃุฏุงุฉ SMB ุจูุญุงูููุง ูุฌูุจูุง ูุนูููุงุช ูู ุงูุณูุฑูุฑุ ูุด ุจูุฎุดูุง ุนูู ูููุฏุฑุงุช ูุจุงุดุฑ ุจู ุจูููููุง ุงูุณูุฑูุฑ ูู ุฎูุงู ุงูููุงู ุงููุฎุตุตู ููุชูุงุตู ุงููู ูู IPC


ูุซุงู ุนููู:

- ููุง ุชุณุฃู ุงูุณูุฑูุฑ: "ุฅูู ุงููููุฏุฑุงุช ุงููู ูุนููู ููุง shareุ"
- ุฃู "ููู ุงูููุฒุฑ ุงููู ุนุงูู login ุฏูููุชูุ"

ุงูุณูุฑูุจุช ุจูุณุชุฎุฏู ุงูู `IPC$` ุนูุดุงู:

- ูุชุตู ุจุงูุณูุฑูุฑ
- ูุทูุจ ููู ูุจุนุชู ุงูุจูุงูุงุช ุฏู
- ุงูุณูุฑูุฑ ูุฑุฏ ุนููู ูู ุฎูุงููุง


ููู ุงูุณูุฑูุฑ ุณุงูุญ ูุงู ุญุฏ ููุตู ุจุฏูู ุตูุงุญูุงุช ูููู ุงููุงูุฑ ูุณุชุฎุฏู ุงู IPC ุนุดุงู ูุฌูุน ูุนูููุงุช ูุชูุฑ ุนู ุงูุณูุฑูุฑ ุจุฏูู ูุง ูุณุฌู ุฏุฎูู ุญูููู 


---



 6๏ธโฃ ูุญุต ุงูู shares ูุฑุฉ ุชุงููุฉ ูููู ุจู user ู password ูู ุฏู ููุฎุชูู ุนู ุงูู ุงุฎุด ูู ุบูุฑ ููุฒุฑ ููุง ุจุงุณูุฑุฏุ ุงููุฏ ููุฎุชูู ูุงู ูุด ููููู ุตูุงุญูุงุช ุงูููุฒุฑ ุฒู ุตูุงุญูุงุช ุงู guest ูููุง ูุนูุง ุฌุฑุจุช ุงูุงุณูุฑูุจุช ุฏู ูุน ุงูููุฒุฑ ููู ูุงูุจุงุณูุฑุฏ ุทูุน ุงู ุงูููุฒุฑ ุฏู ููู ุตูุงุญูุงุช ุงูุชุฑ ูุด ุฒู ุตูุงุญูุงุช ุงู guest 

```
nmap -p445 --script smb-enum-shares --script-args smbusername=administrator,smbpassword=smbserver_771 demo.ine.local
```

๐ ุงููุชูุฌุฉ:  
ุงูููุฒุฑ ุฏู ููู ุตูุงุญูุงุช ุฃูุชุฑ ูู ุงูู Guest.



---

7๏ธโฃ ูุญุต ุงูููุฒุฑุงุช ุงูููุฌูุฏุฉ ุนูู ุงูุณูุฑูุฑ:

```
nmap -p445 --script smb-enum-users --script-args smbusername=administrator,smbpassword=smbserver_771 demo.ine.local
```

๐ ุงููุฑูุ  
ูุฃูุง Guest ุธูุฑ ููุฒุฑ ูุงุญุฏ.  
ูุฃูุง Administrator ุธูุฑ ููุฒุฑุงุช ุฃูุชุฑ.



---

 8๏ธโฃ ูุนุฑูุฉ ุฅุญุตุงุฆูุงุช ุงูุณูุฑูุฑ:

```
nmap -p445 --script smb-server-stats --script-args smbusername=administrator,smbpassword=smbserver_771 demo.ine.local
```

๐ ุจูุนุฑูู:

- ุนุฏุฏ ุงููููุงุช ุงูููุชูุญุฉ ุญุงูููุง
- ุนุฏุฏ ูุญุงููุงุช ุงูุฏุฎูู ุงููุงุดูุฉ
- ุงูุทุงุจุนุงุช ุงููุดุงุฑูุฉ
- ูุญุงููุงุช ุบูุฑ ูุตุฑุญ ุจูุง


---

 9๏ธโฃ ูู ุงูุณูุฑูุฑ ุชุญุช Domain ููุง Workgroupุ

ููู ุงูุฌูุงุฒ ูููู ุชุญุช domain  ูุงู domain ูู SMB/Windows ูุนูู ูุฌููุนู ูู ุงูุงุฌูุฒู ุณูุงุก pc ุงู servers ุจุชุฏุงุฑ ูุฑูุฒูุง ุนู ุทุฑูู Domain controller ุฒู Active directory ูุฏู ููู ุฌูุงุฒ ุงู ููุฒ ุจูุชุณุฌู ุชุญุช ุงู domain ุฏู 

ุงู ูููู ูููู ูู workgroup ูุฏู ุงู ูู ุงูุงุฌูุฒู ูู ุดุจูู ูุญููู ููู ูู ุฌูุงุฒ ูุณุฆูู ุนู ููุณู ูุงูููุฒุฑ ููู ูููุด ุฅุฏุงุฑุฉ ูุฑูุฒูุฉ ูุงูุจุงุณูุฑุฏ ูุงุฒู ูููููุง ููุฌูุฏูู ูุญููุง ุนูู ุงูุฌูุงุฒ ูุนูู ูู ุฌูุงุฒ ูุนูู ุนููู ููุฒุฑ ููู ูุจุงุณูุฑุฏ ููู ุนุงูู ุดูุฑ ูุงูุง ุฌูุงุฒ ุชุงูู ูุนุงูุง ุงูููุฒุฑ ูุงูุจุงุณูุฑุฏ ุจุชูุนู ูุนุงูุฒ ุงุฎุด ุนูู ุงูุดูุฑ ุจุชุงุนู ูุงุฒู ูู ุงููู ูุณูุญ ููุง ูููุงู ูููุด ุณูุงุณุงุช ูุซูุง ูุทุจูู ุนูู ูุฌููุนู ูู ุงูุงุฌูุฒู ูุฑู ูุงุญุฏู

ูุงุณุชุฎุฏููุง ุงุณูุฑูุช ุจูุญุงูู ูุชูุงุตู ูุน ุงู smb ุนูู ุจูุฑุช 445 ุจุงุณุชุฎุฏุงู ุงูููุฒุฑ ูุงูุจุงุณูุฑุฏ ุงููู ุงุฏูุชููููุ ุจูุทูุจ ูู ุงูุณูุฑูุฑ ูุทููุน ูู: ุฅุณู ุงูู **Domain ุฃู Workgroup** ุงููู ุงูุณูุฑูุฑ ุนุถู ููู. 


```
nmap -p445 --script smb-enum-domains --script-args smbusername=administrator,smbpassword=smbserver_771 demo.ine.local
```

๐ ุจูุฌุงูุจู ุงูุณูุฑูุฑ:  
ูู ุชุงุจุน ูู Domain ูุฑูุฒูุ ููุง ูุฌุฑุฏ Workgroup ูุญููุ  
ููู ุฌุฏูุง ูู ุจูุฆุงุช ุงูุดุฑูุงุช!



---

 ๐ ูุนุฑูุฉ ูู ุงูุฌุฑูุจุงุช ุนูู ุงูุณูุฑูุฑ:
 
 ุงุณุชุฎุฏููุง ุงุณูุฑูุจุช ูุทูุน ููุง ูู ุงูุฌุฑูุจุงุช ุจุชุงุน ุงูููุฒุฑุณ ุงููู ูุนูููู ุนูู ุงูุณูุฑูุฑ 

```
nmap -p445 --script smb-enum-groups --script-args smbusername=administrator,smbpassword=smbserver_771 demo.ine.local
```



 ๐ ุฃุฎูุฑูุง: ุนุฑุถ ูู ุงููููุงุช ูุงููููุฏุฑุงุช ูู ุงูู shares

```
nmap -p445 --script smb-enum-shares,smb-ls --script-args smbusername=administrator,smbpassword=smbserver_771 demo.ine.local
```

---

๐ฏ **ุฎูุงุตุฉ ุณุฑูุนุฉ**:

- ุจูุฑุช 445 ูุนูู ููู SMB ุดุบูุงู
    
- SMBv1 = ุฎุทุฑ ูุจูุฑ
- Nmap ุณูุฑูุจุชุงุช ูููุฉ ุฌุฏูุง ูู ุงูู Enumeration
    
- ุงูู IPC$ ููู ูุฌูุน ุงููุนูููุงุช
- ุตูุงุญูุงุช ุงูู Guest ูุฎุชููุฉ ุนู ุงูููุฒุฑ ุงูุญูููู
- ุงูุณูุฑูุฑ ูููู ููุดู ูุชูุฑ ูู ูุด ูุคูููู ูููุณ
---
## ๐ธ Screenshots


![enum-users](./screenshots/enum-users.png)

![enum-groups](./screenshots/enum-groups.png)

![server-stats](./screenshots/server-stats.png)

![enum-shares](./screenshots/enum-shares.png)





    

